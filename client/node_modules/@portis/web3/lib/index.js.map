{"version":3,"file":"index.js","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":"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","sourcesContent":["import ProviderEngine from '@portis/web3-provider-engine';\nimport CacheSubprovider from '@portis/web3-provider-engine/subproviders/cache.js';\nimport FixtureSubprovider from '@portis/web3-provider-engine/subproviders/fixture.js';\nimport FilterSubprovider from '@portis/web3-provider-engine/subproviders/filters.js';\nimport HookedWalletSubprovider from '@portis/web3-provider-engine/subproviders/hooked-wallet.js';\nimport NonceSubprovider from '@portis/web3-provider-engine/subproviders/nonce-tracker.js';\nimport SubscriptionsSubprovider from '@portis/web3-provider-engine/subproviders/subscriptions.js';\nimport Penpal, { AsyncMethodReturns } from 'penpal';\nimport { networkAdapter } from './networks';\nimport { ISDKConfig, IConnectionMethods, INetwork, IOptions } from './interfaces';\nimport { getTxGas } from './utils/getTxGas';\nimport { Query } from './utils/query';\nimport { styles } from './styles';\nimport { validateSecureOrigin } from './utils/secureOrigin';\nimport PocketJSCore from 'pocket-js-core';\n\nconst version = '$$PORTIS_SDK_VERSION$$';\nconst widgetUrl = 'https://widget.portis.io';\nconst supportedScopes = ['email', 'reputation'];\n\nexport default class Portis {\n  config: ISDKConfig;\n  widget: Promise<{\n    communication: AsyncMethodReturns<IConnectionMethods>;\n    iframe: HTMLIFrameElement;\n    widgetFrame: HTMLDivElement;\n  }>;\n  provider;\n  private _selectedAddress: string;\n  private _network: string;\n  private _widgetUrl = widgetUrl;\n  private _onLoginCallback: (walletAddress: string, email?: string, reputation?: string) => void;\n  private _onLogoutCallback: () => void;\n\n  constructor(dappId: string, network: string | INetwork, options: IOptions = {}) {\n    validateSecureOrigin();\n    this._valiadateParams(dappId, network, options);\n    this.config = {\n      dappId,\n      network: networkAdapter(network, options.gasRelay),\n      version,\n      scope: options.scope,\n      registerPageByDefault: options.registerPageByDefault,\n    };\n    this.widget = this._initWidget();\n    this.provider = this._initProvider(options);\n  }\n\n  changeNetwork(network: string | INetwork, gasRelay?: boolean) {\n    const newNetwork = networkAdapter(network, gasRelay);\n    this.clearSubprovider(NonceSubprovider);\n    this.clearSubprovider(CacheSubprovider);\n    this.config.network = newNetwork;\n  }\n\n  setDefaultEmail(email: string) {\n    this.config.defaultEmail = email;\n  }\n\n  async showPortis() {\n    const widgetCommunication = (await this.widget).communication;\n    return widgetCommunication.showPortis(this.config);\n  }\n\n  async logout() {\n    const widgetCommunication = (await this.widget).communication;\n    return widgetCommunication.logout();\n  }\n\n  onLogin(callback: (walletAddress: string, email?: string, reputation?: string) => void) {\n    this._onLoginCallback = callback;\n  }\n\n  onLogout(callback: () => void) {\n    this._onLogoutCallback = callback;\n  }\n\n  async getExtendedPublicKey(path: string = \"m/44'/60'/0'/0/0\") {\n    const widgetCommunication = (await this.widget).communication;\n    return widgetCommunication.getExtendedPublicKey(path, this.config);\n  }\n\n  async importWallet(mnemonicOrPrivateKey: string) {\n    const widgetCommunication = (await this.widget).communication;\n    return widgetCommunication.importWallet(mnemonicOrPrivateKey, this.config);\n  }\n\n  private _valiadateParams(dappId: string, network: string | INetwork, options: IOptions) {\n    if (!dappId) {\n      throw new Error(\"[Portis] 'dappId' is required. Get your dappId here: https://dashboard.portis.io\");\n    }\n\n    if (!network) {\n      throw new Error(\n        \"[Portis] 'network' is required. Read more about it here: https://docs.portis.io/#/configuration?id=network\",\n      );\n    }\n\n    if (options.scope) {\n      if (!Array.isArray(options.scope)) {\n        throw new Error(\n          \"[Portis] 'scope' must be an array. Read more about it here: https://docs.portis.io/#/configuration?id=scope\",\n        );\n      }\n\n      const unknownScope = options.scope.filter(item => supportedScopes.indexOf(item) < 0);\n      if (unknownScope.length > 0) {\n        throw new Error(\n          \"[Portis] invalid 'scope' parameter. Read more about it here: https://docs.portis.io/#/configuration?id=scope\",\n        );\n      }\n    }\n\n    if (options.registerPageByDefault !== undefined && typeof options.registerPageByDefault !== 'boolean') {\n      throw new Error(\n        \"[Portis] invalid 'registerPageByDefault' parameter, must be a boolean. Read more about it here: https://docs.portis.io/#/configuration?id=registerPageByDefault\",\n      );\n    }\n  }\n\n  private _initWidget(): Promise<{\n    communication: AsyncMethodReturns<IConnectionMethods>;\n    iframe: HTMLIFrameElement;\n    widgetFrame: HTMLDivElement;\n  }> {\n    return new Promise((resolve, reject) => {\n      const onload = async () => {\n        const style = document.createElement('style');\n        style.innerHTML = styles;\n\n        const container = document.createElement('div');\n        container.className = 'por_portis-container';\n\n        const widgetFrame = document.createElement('div');\n        widgetFrame.id = `portis-container-${Date.now()}`;\n        widgetFrame.className = 'por_portis-widget-frame';\n\n        container.appendChild(widgetFrame);\n        document.body.appendChild(container);\n        document.head.appendChild(style);\n\n        const connection = Penpal.connectToChild<IConnectionMethods>({\n          url: this._widgetUrl,\n          appendTo: document.getElementById(widgetFrame.id)!,\n          methods: {\n            setHeight: this._setHeight.bind(this),\n            getWindowSize: this._getWindowSize.bind(this),\n            onLogin: this._onLogin.bind(this),\n            onLogout: this._onLogout.bind(this),\n          },\n        });\n\n        connection.iframe.style.position = 'absolute';\n        connection.iframe.style.height = '100%';\n        connection.iframe.style.width = '100%';\n        connection.iframe.style.border = '0 transparent';\n\n        const communication = await connection.promise;\n        resolve({ communication, iframe: connection.iframe, widgetFrame });\n      };\n\n      if (['loaded', 'interactive', 'complete'].indexOf(document.readyState) > -1) {\n        onload();\n      } else {\n        window.addEventListener('load', onload.bind(this), false);\n      }\n    });\n  }\n\n  private _initProvider(options: IOptions) {\n    const engine = new ProviderEngine();\n    const query = new Query(engine);\n\n    engine.send = (payload, callback) => {\n      // Web3 1.0 beta.38 (and above) calls `send` with method and parameters\n      if (typeof payload === 'string') {\n        return new Promise((resolve, reject) => {\n          engine.sendAsync(\n            {\n              jsonrpc: '2.0',\n              id: 42,\n              method: payload,\n              params: callback || [],\n            },\n            (error, response) => {\n              if (error) {\n                reject(error);\n              } else {\n                resolve(response.result);\n              }\n            },\n          );\n        });\n      }\n\n      // Web3 1.0 beta.37 (and below) uses `send` with a callback for async queries\n      if (callback) {\n        engine.sendAsync(payload, callback);\n        return;\n      }\n\n      let result: any = null;\n      switch (payload.method) {\n        case 'eth_accounts':\n          result = this._selectedAddress ? [this._selectedAddress] : [];\n          break;\n\n        case 'eth_coinbase':\n          result = this._selectedAddress ? [this._selectedAddress] : [];\n          break;\n\n        case 'net_version':\n          result = this._network;\n          break;\n\n        case 'eth_uninstallFilter':\n          engine.sendAsync(payload, _ => _);\n          result = true;\n          break;\n\n        default:\n          var message = `The Portis Web3 object does not support synchronous methods like ${\n            payload.method\n          } without a callback parameter.`;\n          throw new Error(message);\n      }\n\n      return {\n        id: payload.id,\n        jsonrpc: payload.jsonrpc,\n        result: result,\n      };\n    };\n\n    engine.addProvider(\n      new FixtureSubprovider({\n        web3_clientVersion: `Portis/v${this.config.version}/javascript`,\n        net_listening: true,\n        eth_hashrate: '0x00',\n        eth_mining: false,\n        eth_syncing: true,\n      }),\n    );\n\n    engine.addProvider(new CacheSubprovider());\n    engine.addProvider(new SubscriptionsSubprovider());\n    engine.addProvider(new FilterSubprovider());\n    engine.addProvider(new NonceSubprovider());\n    engine.addProvider({\n      setEngine: _ => _,\n      handleRequest: async (payload, next, end) => {\n        if (!payload.id) {\n          payload.id = 42;\n        }\n        next();\n      },\n    });\n\n    engine.addProvider(\n      new HookedWalletSubprovider({\n        getAccounts: async cb => {\n          const widgetCommunication = (await this.widget).communication;\n          const { error, result } = await widgetCommunication.getAccounts(this.config);\n          if (!error && result) {\n            this._selectedAddress = result[0];\n          }\n          cb(error, result);\n        },\n        signTransaction: async (txParams, cb) => {\n          const widgetCommunication = (await this.widget).communication;\n          const { error, result } = await widgetCommunication.signTransaction(txParams, this.config);\n          cb(error, result);\n        },\n        signMessage: async (msgParams, cb) => {\n          const widgetCommunication = (await this.widget).communication;\n          const params = Object.assign({}, msgParams, { messageStandard: 'signMessage' });\n          const { error, result } = await widgetCommunication.signMessage(params, this.config);\n          cb(error, result);\n        },\n        signPersonalMessage: async (msgParams, cb) => {\n          const widgetCommunication = (await this.widget).communication;\n          const params = Object.assign({}, msgParams, { messageStandard: 'signPersonalMessage' });\n          const { error, result } = await widgetCommunication.signMessage(params, this.config);\n          cb(error, result);\n        },\n        signTypedMessage: async (msgParams, cb) => {\n          const widgetCommunication = (await this.widget).communication;\n          const params = Object.assign({}, msgParams, { messageStandard: 'signTypedMessage' });\n          const { error, result } = await widgetCommunication.signMessage(params, this.config);\n          cb(error, result);\n        },\n        signTypedMessageV3: async (msgParams, cb) => {\n          const widgetCommunication = (await this.widget).communication;\n          const params = Object.assign({}, msgParams, { messageStandard: 'signTypedMessageV3' });\n          const { error, result } = await widgetCommunication.signMessage(params, this.config);\n          cb(error, result);\n        },\n        estimateGas: async (txParams, cb) => {\n          const gas = await getTxGas(query, txParams);\n          cb(null, gas);\n        },\n        getGasPrice: async cb => {\n          cb(null, '');\n        },\n      }),\n    );\n\n    if (!options.pocketDevId) {\n      engine.addProvider({\n        setEngine: _ => _,\n        handleRequest: async (payload, next, end) => {\n          const widgetCommunication = (await this.widget).communication;\n          const { error, result } = await widgetCommunication.relay(payload, this.config);\n          if (payload.method === 'net_version') {\n            this._network = result;\n            engine.networkVersion = this._network;\n          }\n          end(error, result);\n        },\n      });\n    } else {\n      const pocket = new PocketJSCore.Pocket({\n        devID: options.pocketDevId,\n        networkName: 'ETH',\n        netIDs: [this.config.network.chainId],\n      });\n      engine.addProvider({\n        setEngine: _ => _,\n        handleRequest: async (payload, next, end) => {\n          const response = await pocket.sendRelay(\n            new PocketJSCore.Relay('ETH', this.config.network.chainId, JSON.stringify(payload), pocket.configuration),\n          );\n          let result;\n          let error;\n          if (response instanceof Error || !response) {\n            error = response || new Error('Unknown error');\n            result = null;\n          } else {\n            try {\n              result = JSON.parse(response).result;\n              error = null;\n            } catch (e) {\n              result = null;\n              error = e;\n            }\n          }\n          if (payload.method === 'net_version') {\n            this._network = result;\n            engine.networkVersion = this._network;\n          }\n          end(error, result);\n        },\n      });\n    }\n\n    engine.enable = () =>\n      new Promise((resolve, reject) => {\n        engine.sendAsync({ method: 'eth_accounts' }, (error, response) => {\n          if (error) {\n            reject(error);\n          } else {\n            resolve(response.result);\n          }\n        });\n      });\n\n    engine.isConnected = () => {\n      return true;\n    };\n\n    engine.isPortis = true;\n\n    engine.on('error', error => {\n      if (error && error.message && error.message.includes('PollingBlockTracker')) {\n        console.warn('If you see this warning constantly, there might be an error with your RPC node.');\n      } else {\n        console.error(error);\n      }\n    });\n\n    engine.start();\n    return engine;\n  }\n\n  private async _setHeight(height: number) {\n    const widgetFrame = (await this.widget).widgetFrame;\n    widgetFrame.style.height = `${height}px`;\n  }\n\n  private _getWindowSize() {\n    const body = document.getElementsByTagName('body')[0];\n    const width = window.innerWidth || document.documentElement.clientWidth || body.clientWidth;\n    const height = window.innerHeight || document.documentElement.clientHeight || body.clientHeight;\n    return { width, height };\n  }\n\n  private _onLogin(walletAddress: string, email?: string, reputation?: string) {\n    if (this._onLoginCallback) {\n      this._onLoginCallback(walletAddress, email, reputation);\n    }\n  }\n\n  private _onLogout() {\n    this._selectedAddress = '';\n    if (this._onLogoutCallback) {\n      this._onLogoutCallback();\n    }\n  }\n\n  private clearSubprovider(subproviderType) {\n    const subprovider = this.provider._providers.find(subprovider => subprovider instanceof subproviderType);\n    this.provider.removeProvider(subprovider);\n    this.provider.addProvider(new subproviderType());\n  }\n}\n"]}